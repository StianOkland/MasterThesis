{"ast":null,"code":"import _regeneratorRuntime from \"/home/ablab/Desktop/MasterThesis/toohak/testweb/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/ablab/Desktop/MasterThesis/toohak/testweb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _readOnlyError from \"/home/ablab/Desktop/MasterThesis/toohak/testweb/node_modules/@babel/runtime/helpers/esm/readOnlyError\";\nimport Automerge, { Connection } from 'automerge';\nimport io from 'socket.io-client';\nexport var docSet = new Automerge.DocSet();\nexport var socket = null;\nexport var docarray = [];\nexport default function getConnected(callback) {\n  socket = io(\"http://localhost:3000\");\n  socket.on('data', function (_ref) {\n    var data = _ref.data,\n        name = _ref.name;\n    var doc = docSet.getDoc(name);\n    doc = Automerge.change(doc, function (doc) {\n      doc.chards = ['hei'];\n    });\n    docSet.setDoc(name, doc);\n  });\n  socket.on('add doc web', /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n      var title, change, initDoc, changes, doc;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              title = _ref2.title, change = _ref2.change;\n              initDoc = Automerge.change(Automerge.init(), function (doc) {\n                doc.title = title, doc.cards = [];\n              });\n              changes = JSON.parse(change);\n              doc = Automerge.applyChanges(initDoc, changes);\n              docSet.setDoc(title, doc);\n              docarray = (_readOnlyError(\"docarray\"), Array.from(docSet.docs));\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }());\n  socket.on('close', function () {\n    console.log(\"[\".concat(HOST, \":\").concat(PORT, \"] connection closed\"));\n  });\n  socket.on('error', function (err) {\n    console.log(\"[\".concat(socket.remoteAddress, \":\").concat(socket.remotePort, \"] error: \").concat(err));\n  });\n  socket.on('add card web', /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref4) {\n      var name, change, doc, changes;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              name = _ref4.name, change = _ref4.change;\n              doc = docSet.getDoc(name);\n              changes = JSON.parse(change);\n              doc2 = Automerge.applyChanges(doc, changes);\n              docSet.setDoc(name, doc2);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }());\n  socket.on('add doc new doc', function (_ref6) {\n    var name = _ref6.name,\n        change = _ref6.change;\n    var initDoc = Automerge.init();\n    var doc1 = Automerge.change(initDoc, function (doc) {\n      doc.title = name, doc.cards = [];\n    });\n    var changes = JSON.parse(change);\n    var doc = Automerge.applyChanges(doc1, changes);\n    docSet.setDoc(doc.title, doc);\n    docarray = (_readOnlyError(\"docarray\"), Array.from(docSet.docs));\n  });\n  socket.on('add doc new card', /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref7) {\n      var name, change, doc, changes, _doc;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              name = _ref7.name, change = _ref7.change;\n              doc = docSet.getDoc(name);\n\n              if (doc) {\n                changes = JSON.parse(change);\n                _doc = Automerge.applyChanges(doc, changes);\n                docSet.setDoc(_doc.title, _doc);\n                docarray = (_readOnlyError(\"docarray\"), Array.from(docSet.docs));\n              }\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x3) {\n      return _ref8.apply(this, arguments);\n    };\n  }());\n}","map":{"version":3,"sources":["/home/ablab/Desktop/MasterThesis/toohak/testweb/pages/common.js"],"names":["Automerge","Connection","io","docSet","DocSet","socket","docarray","getConnected","callback","on","data","name","doc","getDoc","change","chards","setDoc","title","initDoc","init","cards","changes","JSON","parse","applyChanges","Array","from","docs","console","log","HOST","PORT","err","remoteAddress","remotePort","doc2","doc1"],"mappings":"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","sourcesContent":["import Automerge, { Connection } from 'automerge'\nimport io from 'socket.io-client'\nexport const docSet = new Automerge.DocSet()\n\nexport let socket = null;\nexport const docarray = [];\n\nexport default function getConnected( callback ) {\n    socket = io(\"http://localhost:3000\")\n\n    socket.on('data', ({data, name}) => {\n        let doc = docSet.getDoc(name)\n        doc = Automerge.change(doc, doc => {\n          doc.chards = ['hei']\n        })\n        docSet.setDoc(name, doc)\n    })\n      \n    socket.on('add doc web', async ({title, change}) => {\n        const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = title, doc.cards = []})\n        let changes = JSON.parse(change)\n\n        const doc = Automerge.applyChanges(initDoc, changes)\n        docSet.setDoc(title, doc)\n        docarray = Array.from(docSet.docs)\n    })\n\n    socket.on('close', () => {\n        console.log(`[${HOST}:${PORT}] connection closed`)\n    })\n\n    socket.on('error', (err) => {\n        console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`)\n    })\n\n    socket.on('add card web', async ({name, change}) => {\n        const doc = docSet.getDoc(name)\n        let changes = JSON.parse(change)\n        doc2 = Automerge.applyChanges(doc, changes)\n        docSet.setDoc(name, doc2)\n    })\n\n    socket.on('add doc new doc',  ({name, change}) => {\n        let initDoc = Automerge.init()\n        let doc1 = Automerge.change(initDoc, doc => {doc.title = name, doc.cards = []})\n        let changes = JSON.parse(change)\n\n        const doc = Automerge.applyChanges(doc1, changes)\n        docSet.setDoc(doc.title, doc)\n        docarray = Array.from(docSet.docs)\n    })\n\n    socket.on('add doc new card', async ({name, change}) => {\n      const doc = docSet.getDoc(name)\n      if (doc) {\n          let changes = JSON.parse(change)\n          const doc2 = Automerge.applyChanges(doc, changes)\n          docSet.setDoc(doc2.title, doc2)\n          docarray = Array.from(docSet.docs)\n      }\n    })\n}\n"]},"metadata":{},"sourceType":"module"}