{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ablab/Desktop/MasterThesis/toohak/testweb/pages/index.js\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport uuid from 'react-native-uuid';\nimport Automerge, { init } from 'automerge';\nimport Head from 'next/head';\nimport io from 'socket.io-client';\nimport conn, { docSet, socket, docarray } from './common';\ndocSet.registerHandler((docId, doc) => {\n  console.log(`[${docId}] ${JSON.stringify(doc)}`);\n});\nexport default class Home extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"connect\", () => {\n      conn(respons => {\n        this.setState({\n          isConnected: respons\n        });\n      });\n    });\n\n    this.state = {\n      data: [{\n        \"name\": \"test1\"\n      }, {\n        \"name\": \"test2\"\n      }],\n      results: [],\n      docarray: '',\n      docname: 'testdoc',\n      question: '',\n      answer: '',\n      questionNumber: 0,\n      socket: null\n    };\n    this.handleChangeName = this.handleChangeName.bind(this);\n    this.handleQuestionTitle = this.handleQuestionTitle.bind(this);\n    this.handleQuestionAnswer = this.handleQuestionAnswer.bind(this);\n    this.handleQuestionNumber = this.handleQuestionNumber.bind(this);\n    this.addDoc = this.addDoc.bind(this);\n    this.deleteDoc = this.deleteDoc.bind(this);\n    this.addQ = this.addQ.bind(this);\n    this.addA = this.addA.bind(this);\n  } // componentDidMount() {\n  //   this.socket = io(\"http://localhost:3000\")\n  //   this.socket.on('data', ({data, name}) => {\n  //       let doc = docSet.getDoc(name)\n  //       doc = Automerge.change(doc, doc => {\n  //         doc.chards = ['hei']\n  //       })\n  //       docSet.setDoc(name, doc)\n  //   })\n  //   this.socket.on('add doc web', async ({title, change}) => {\n  //       const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = title, doc.cards = []})\n  //       let changes = JSON.parse(change)\n  //       const doc = Automerge.applyChanges(initDoc, changes)\n  //       docSet.setDoc(title, doc)\n  //       this.state.docarray = Array.from(docSet.docs)\n  //   })\n  //   this.socket.on('close', () => {\n  //       console.log(`[${HOST}:${PORT}] connection closed`)\n  //   })\n  //   this.socket.on('error', (err) => {\n  //       console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`)\n  //   })\n  //   this.socket.on('add card web', async ({name, change}) => {\n  //       const doc = docSet.getDoc(name)\n  //       let changes = JSON.parse(change)\n  //       doc2 = Automerge.applyChanges(doc, changes)\n  //       docSet.setDoc(name, doc2)\n  //   })\n  //   this.socket.on('add doc new doc',  ({name, change}) => {\n  //       let initDoc = Automerge.init()\n  //       let doc1 = Automerge.change(initDoc, doc => {doc.title = name, doc.cards = []})\n  //       let changes = JSON.parse(change)\n  //       const doc = Automerge.applyChanges(doc1, changes)\n  //       docSet.setDoc(doc.title, doc)\n  //       this.setState({docarray : Array.from(docSet.docs)})\n  //   })\n  //   this.socket.on('add doc new card', async ({name, change}) => {\n  //     const doc = docSet.getDoc(name)\n  //     if (doc) {\n  //         let changes = JSON.parse(change)\n  //         const doc2 = Automerge.applyChanges(doc, changes)\n  //         docSet.setDoc(doc2.title, doc2)\n  //         this.setState({docarray : Array.from(docSet.docs)})\n  //     }\n  //   })\n  // }\n\n\n  conn() {\n    const tmp = io(\"http://\" + this.state.address + \":3000\");\n    this.setState({\n      socket: tmp\n    });\n  }\n\n  handleChangeName(e) {\n    this.setState({\n      docname: e.target.value\n    });\n  }\n\n  handleQuestionTitle(e) {\n    this.setState({\n      question: e.target.value\n    });\n  }\n\n  handleQuestionAnswer(e) {\n    this.setState({\n      answer: e.target.value\n    });\n  }\n\n  handleQuestionNumber(e) {\n    this.setState({\n      questionNumber: e.target.value\n    });\n  }\n\n  addDoc() {\n    let initDoc = Automerge.change(Automerge.init(), doc => {\n      doc.title = this.state.docname, doc.cards = [];\n    });\n    docSet.setDoc(this.state.docname, initDoc);\n    this.setState({\n      docarray: Array.from(docSet.docs)\n    });\n    let changes = Automerge.getAllChanges(initDoc);\n\n    if (this.state.socket != null) {\n      this.socket.emit(\"add doc\", {\n        title: this.state.docname,\n        change: JSON.stringify(changes)\n      });\n    }\n  }\n\n  deleteDoc() {\n    let doc = docSet.getDoc(this.state.docname);\n\n    if (doc) {\n      docSet.removeDoc(this.state.docname);\n    }\n\n    this.setState({\n      docarray: Array.from(docSet.docs)\n    });\n  }\n\n  addQ() {\n    let id = uuid.v4();\n    let doc1 = docSet.getDoc(this.state.docname);\n\n    if (doc1) {\n      const doc2 = Automerge.change(doc1, doc => {\n        doc.cards.push({\n          id: id,\n          Question: this.state.question,\n          Answers: []\n        });\n      });\n      docSet.setDoc(this.state.docname, doc2);\n      this.setState({\n        docarray: Array.from(docSet.docs)\n      });\n      const changes = Automerge.getAllChanges(doc2);\n      this.socket.emit(\"add question\", {\n        title: this.state.docname,\n        change: JSON.stringify(changes)\n      });\n    }\n  }\n\n  addA() {\n    let id = uuid.v4();\n    let doc1 = docSet.getDoc(this.state.docname);\n\n    if (doc1) {\n      let doc2 = Automerge.change(doc1, doc => {\n        doc.cards[this.state.questionNumber]['Answer'].push({\n          id: id,\n          a: this.state.answer\n        });\n      });\n      docSet.setDoc(this.state.docname, doc2);\n      this.setState({\n        docarray: Array.from(docSet.docs)\n      });\n      this.socket.emit(\"add question\", {\n        title: this.state.docname,\n        change: JSON.stringify(changes)\n      });\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Head, {\n        children: /*#__PURE__*/_jsxDEV(\"title\", {\n          children: \"Toohak\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Toohak!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"button\",\n        onClick: this.connect,\n        value: \"Go online\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleChangeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"button\",\n        onClick: this.addDoc,\n        value: \"Add a new document\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleChangeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"button\",\n        onClick: this.deleteDoc,\n        value: \"Delete a document\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleChangeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleQuestionTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"button\",\n        onClick: this.addQ,\n        value: \"Add a question to a document\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleChangeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleQuestionTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        onChange: this.handleQuestionNumber\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onChange: this.handleQuestionAnswer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"button\",\n        onClick: this.addA,\n        value: \"Answer a question in a document\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        children: [\"Documents: \", JSON.stringify(this.state.docarray, null, 2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/home/ablab/Desktop/MasterThesis/toohak/testweb/pages/index.js"],"names":["React","uuid","Automerge","init","Head","io","conn","docSet","socket","docarray","registerHandler","docId","doc","console","log","JSON","stringify","Home","Component","constructor","props","respons","setState","isConnected","state","data","results","docname","question","answer","questionNumber","handleChangeName","bind","handleQuestionTitle","handleQuestionAnswer","handleQuestionNumber","addDoc","deleteDoc","addQ","addA","tmp","address","e","target","value","initDoc","change","title","cards","setDoc","Array","from","docs","changes","getAllChanges","emit","getDoc","removeDoc","id","v4","doc1","doc2","push","Question","Answers","a","render","connect"],"mappings":"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","sourcesContent":["import React from 'react'\nimport uuid from 'react-native-uuid';\nimport Automerge, { init } from 'automerge'\nimport Head from 'next/head'\nimport io from 'socket.io-client'\n\nimport conn ,{ docSet, socket, docarray } from './common'\n\ndocSet.registerHandler((docId, doc) => {\n    console.log(`[${docId}] ${JSON.stringify(doc)}`)\n})\n\n\n\n\n\nexport default class Home extends React.Component {\n  \n  constructor(props) {\n    super(props)\n    this.state = {\n      data: [{\"name\":\"test1\"},{\"name\":\"test2\"}],\n      results: [],\n      docarray: '',\n      docname:'testdoc',\n      question: '',\n      answer: '',\n      questionNumber: 0,\n      socket: null\n    }\n    this.handleChangeName = this.handleChangeName.bind(this)\n    this.handleQuestionTitle = this.handleQuestionTitle.bind(this)\n    this.handleQuestionAnswer = this.handleQuestionAnswer.bind(this)\n    this.handleQuestionNumber = this.handleQuestionNumber.bind(this)\n    this.addDoc = this.addDoc.bind(this)\n    this.deleteDoc = this.deleteDoc.bind(this)\n    this.addQ = this.addQ.bind(this)\n    this.addA = this.addA.bind(this)\n  }\n\n\n  // componentDidMount() {\n  //   this.socket = io(\"http://localhost:3000\")\n\n  //   this.socket.on('data', ({data, name}) => {\n  //       let doc = docSet.getDoc(name)\n  //       doc = Automerge.change(doc, doc => {\n  //         doc.chards = ['hei']\n  //       })\n  //       docSet.setDoc(name, doc)\n  //   })\n      \n  //   this.socket.on('add doc web', async ({title, change}) => {\n  //       const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = title, doc.cards = []})\n  //       let changes = JSON.parse(change)\n\n  //       const doc = Automerge.applyChanges(initDoc, changes)\n  //       docSet.setDoc(title, doc)\n  //       this.state.docarray = Array.from(docSet.docs)\n  //   })\n\n  //   this.socket.on('close', () => {\n  //       console.log(`[${HOST}:${PORT}] connection closed`)\n  //   })\n\n  //   this.socket.on('error', (err) => {\n  //       console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`)\n  //   })\n\n  //   this.socket.on('add card web', async ({name, change}) => {\n  //       const doc = docSet.getDoc(name)\n  //       let changes = JSON.parse(change)\n  //       doc2 = Automerge.applyChanges(doc, changes)\n  //       docSet.setDoc(name, doc2)\n  //   })\n\n  //   this.socket.on('add doc new doc',  ({name, change}) => {\n  //       let initDoc = Automerge.init()\n  //       let doc1 = Automerge.change(initDoc, doc => {doc.title = name, doc.cards = []})\n  //       let changes = JSON.parse(change)\n\n  //       const doc = Automerge.applyChanges(doc1, changes)\n  //       docSet.setDoc(doc.title, doc)\n  //       this.setState({docarray : Array.from(docSet.docs)})\n  //   })\n\n  //   this.socket.on('add doc new card', async ({name, change}) => {\n  //     const doc = docSet.getDoc(name)\n  //     if (doc) {\n  //         let changes = JSON.parse(change)\n  //         const doc2 = Automerge.applyChanges(doc, changes)\n  //         docSet.setDoc(doc2.title, doc2)\n  //         this.setState({docarray : Array.from(docSet.docs)})\n  //     }\n  //   })\n  // }\n\n  conn() {\n    const tmp = io(\"http://\" + this.state.address + \":3000\")\n    this.setState({socket: tmp})\n}\n\n\n  connect = () => {\n    conn(( respons ) => {\n      this.setState({ isConnected: respons})\n    })\n  }\n \n  handleChangeName(e) {\n    this.setState({docname: e.target.value})\n  }\n  handleQuestionTitle(e) {\n    this.setState({question: e.target.value})\n  }\n  handleQuestionAnswer(e) {\n    this.setState({answer: e.target.value})\n  }\n  handleQuestionNumber(e) {\n    this.setState({questionNumber: e.target.value})\n  }\n  \n  \n  addDoc() {\n    let initDoc = Automerge.change(Automerge.init(), doc => {doc.title = this.state.docname, doc.cards = []})\n    docSet.setDoc(this.state.docname, initDoc)\n    this.setState({docarray : Array.from(docSet.docs)})\n    \n    let changes = Automerge.getAllChanges(initDoc)\n    if(this.state.socket != null) {\n      this.socket.emit(\"add doc\", ({title: this.state.docname, change: JSON.stringify(changes)}))\n    }\n  }\n\n  deleteDoc() {\n    let doc = docSet.getDoc(this.state.docname)\n    if (doc) {\n        docSet.removeDoc(this.state.docname)\n    }\n    this.setState({docarray : Array.from(docSet.docs)})\n  }\n\n  addQ() {\n    let id = uuid.v4()\n    let doc1 = docSet.getDoc(this.state.docname)\n    if (doc1) {\n      const doc2 = Automerge.change(doc1, doc => {\n        doc.cards.push({id: id, Question: this.state.question, Answers: []})\n      })\n      docSet.setDoc(this.state.docname, doc2)\n      this.setState({docarray : Array.from(docSet.docs)})\n      const changes = Automerge.getAllChanges(doc2)\n\n      this.socket.emit(\"add question\", ({title: this.state.docname, change: JSON.stringify(changes)}))\n      \n    }\n  }\n\n  addA() {\n    let id = uuid.v4()\n    let doc1 = docSet.getDoc(this.state.docname)\n    if (doc1) {\n      let doc2 = Automerge.change(doc1, doc => {\n        doc.cards[this.state.questionNumber]['Answer'].push({id: id, a: this.state.answer})\n      })\n      docSet.setDoc(this.state.docname, doc2)\n      this.setState({docarray : Array.from(docSet.docs)})\n      this.socket.emit(\"add question\", ({title: this.state.docname, change: JSON.stringify(changes)}))\n      \n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <Head>\n          <title>Toohak</title>\n        </Head>\n        <h1>Toohak!</h1>\n        <input \n          type='button'\n          onClick={this.connect}\n          value='Go online'\n        />\n        \n        <input type='text' onChange={this.handleChangeName}/>\n        <input \n          type='button'\n          onClick={this.addDoc}\n          value='Add a new document'\n        />\n        <br/>\n        <input type='text' onChange={this.handleChangeName}/>\n        <input \n          type='button'\n          onClick={this.deleteDoc}\n          value='Delete a document'\n        />\n        <br/>\n        <input type='text' onChange={this.handleChangeName}/>\n        <input type='text' onChange={this.handleQuestionTitle}/>\n        \n        <input \n          type='button'\n          onClick={this.addQ}\n          value='Add a question to a document'\n        />\n        <br/>\n        <input type='text' onChange={this.handleChangeName}/>\n        <input type='text' onChange={this.handleQuestionTitle}/>\n        <input type='number' onChange={this.handleQuestionNumber}/>\n        <input type='text' onChange={this.handleQuestionAnswer}/>\n\n\n        \n        <input \n          type='button'\n          onClick={this.addA}\n          value='Answer a question in a document'\n        />\n     \n\n        <pre>Documents: {JSON.stringify(this.state.docarray, null, 2)}</pre>\n      </div>\n\n    ) \n  }\n}\n"]},"metadata":{},"sourceType":"module"}