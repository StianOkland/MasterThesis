{"ast":null,"code":"import Automerge, { Connection } from 'automerge';\nimport io from 'socket.io-client';\nexport const docSet = new Automerge.DocSet();\nexport let socket = null;\nexport let docarray = [];\nexport default function getConnected(callback) {\n  this.socket = io(\"http://localhost:3000\");\n  this.socket.on('data', ({\n    data,\n    name\n  }) => {\n    let doc = docSet.getDoc(name);\n    doc = Automerge.change(doc, doc => {\n      doc.chards = ['hei'];\n    });\n    docSet.setDoc(name, doc);\n  });\n  this.socket.on('add doc web', async ({\n    title,\n    change\n  }) => {\n    const initDoc = Automerge.change(Automerge.init(), doc => {\n      doc.title = title, doc.cards = [];\n    });\n    let changes = JSON.parse(change);\n    const doc = Automerge.applyChanges(initDoc, changes);\n    docSet.setDoc(title, doc);\n    this.state.docarray = Array.from(docSet.docs);\n  });\n  this.socket.on('close', () => {\n    console.log(`[${HOST}:${PORT}] connection closed`);\n  });\n  this.socket.on('error', err => {\n    console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`);\n  });\n  this.socket.on('add card web', async ({\n    name,\n    change\n  }) => {\n    const doc = docSet.getDoc(name);\n    let changes = JSON.parse(change);\n    doc2 = Automerge.applyChanges(doc, changes);\n    docSet.setDoc(name, doc2);\n  });\n  this.socket.on('add doc new doc', ({\n    name,\n    change\n  }) => {\n    let initDoc = Automerge.init();\n    let doc1 = Automerge.change(initDoc, doc => {\n      doc.title = name, doc.cards = [];\n    });\n    let changes = JSON.parse(change);\n    const doc = Automerge.applyChanges(doc1, changes);\n    docSet.setDoc(doc.title, doc);\n    this.setState({\n      docarray: Array.from(docSet.docs)\n    });\n  });\n  this.socket.on('add doc new card', async ({\n    name,\n    change\n  }) => {\n    const doc = docSet.getDoc(name);\n\n    if (doc) {\n      let changes = JSON.parse(change);\n      const doc2 = Automerge.applyChanges(doc, changes);\n      docSet.setDoc(doc2.title, doc2);\n      this.setState({\n        docarray: Array.from(docSet.docs)\n      });\n    }\n  });\n}","map":{"version":3,"sources":["/home/ablab/Desktop/MasterThesis/toohak/testweb/pages/common.js"],"names":["Automerge","Connection","io","docSet","DocSet","socket","docarray","getConnected","callback","on","data","name","doc","getDoc","change","chards","setDoc","title","initDoc","init","cards","changes","JSON","parse","applyChanges","state","Array","from","docs","console","log","HOST","PORT","err","remoteAddress","remotePort","doc2","doc1","setState"],"mappings":"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","sourcesContent":["import Automerge, { Connection } from 'automerge'\nimport io from 'socket.io-client'\nexport const docSet = new Automerge.DocSet()\n\nexport let socket = null;\nexport let docarray = [];\n\nexport default function getConnected( callback ) {\n    this.socket = io(\"http://localhost:3000\")\n\n    this.socket.on('data', ({data, name}) => {\n        let doc = docSet.getDoc(name)\n        doc = Automerge.change(doc, doc => {\n          doc.chards = ['hei']\n        })\n        docSet.setDoc(name, doc)\n    })\n      \n    this.socket.on('add doc web', async ({title, change}) => {\n        const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = title, doc.cards = []})\n        let changes = JSON.parse(change)\n\n        const doc = Automerge.applyChanges(initDoc, changes)\n        docSet.setDoc(title, doc)\n        this.state.docarray = Array.from(docSet.docs)\n    })\n\n    this.socket.on('close', () => {\n        console.log(`[${HOST}:${PORT}] connection closed`)\n    })\n\n    this.socket.on('error', (err) => {\n        console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`)\n    })\n\n    this.socket.on('add card web', async ({name, change}) => {\n        const doc = docSet.getDoc(name)\n        let changes = JSON.parse(change)\n        doc2 = Automerge.applyChanges(doc, changes)\n        docSet.setDoc(name, doc2)\n    })\n\n    this.socket.on('add doc new doc',  ({name, change}) => {\n        let initDoc = Automerge.init()\n        let doc1 = Automerge.change(initDoc, doc => {doc.title = name, doc.cards = []})\n        let changes = JSON.parse(change)\n\n        const doc = Automerge.applyChanges(doc1, changes)\n        docSet.setDoc(doc.title, doc)\n        this.setState({docarray : Array.from(docSet.docs)})\n    })\n\n    this.socket.on('add doc new card', async ({name, change}) => {\n      const doc = docSet.getDoc(name)\n      if (doc) {\n          let changes = JSON.parse(change)\n          const doc2 = Automerge.applyChanges(doc, changes)\n          docSet.setDoc(doc2.title, doc2)\n          this.setState({docarray : Array.from(docSet.docs)})\n      }\n    })\n}\n"]},"metadata":{},"sourceType":"module"}