{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/ablab/Desktop/toohak/testweb/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/home/ablab/Desktop/toohak/testweb/pages/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport uuid from 'react-native-uuid';\nimport Automerge from 'automerge';\nimport Head from 'next/head';\nimport io from 'socket.io-client';\nvar docSet = new Automerge.DocSet();\ndocSet.registerHandler(function (docId, doc) {\n  console.log(\"[\".concat(docId, \"] \").concat(JSON.stringify(doc)));\n});\n\nvar Home = /*#__PURE__*/function (_React$Component) {\n  _inherits(Home, _React$Component);\n\n  var _super = _createSuper(Home);\n\n  function Home(props) {\n    var _this;\n\n    _classCallCheck(this, Home);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      data: [{\n        \"name\": \"test1\"\n      }, {\n        \"name\": \"test2\"\n      }],\n      results: [],\n      docarray: '',\n      docname: 'testdoc',\n      socket: null\n    };\n    return _this;\n  }\n\n  _createClass(Home, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        socket: io(\"http://localhost:3000\")\n      }); // const socket = io(\"http://localhost:3000\")\n\n      this.state.socket.on('data', function (_ref) {\n        var data = _ref.data,\n            name = _ref.name;\n        var doc = docSet.getDoc(name);\n        doc = Automerge.change(doc, function (doc) {\n          doc.chards = ['hei'];\n        });\n        docSet.setDoc(name, doc);\n      });\n      this.state.socket.on('add doc web', function (_ref2) {\n        var title = _ref2.title,\n            change = _ref2.change;\n        var initDoc = Automerge.change(Automerge.init(), function (doc) {\n          doc.title = title, doc.cards = [];\n        });\n        var changes = JSON.parse(change);\n        doc = Automerge.applyChanges(initDoc, changes);\n        docSet.setDoc(title, doc);\n        state.docarray = Array.from(docSet.docs);\n      });\n      this.state.socket.on('close', function () {\n        console.log(\"[\".concat(HOST, \":\").concat(PORT, \"] connection closed\"));\n      });\n      this.state.socket.on('error', function (err) {\n        console.log(\"[\".concat(socket.remoteAddress, \":\").concat(socket.remotePort, \"] error: \").concat(err));\n      });\n      this.state.socket.on('add card web', function (_ref3) {\n        var name = _ref3.name,\n            change = _ref3.change;\n        var doc = docSet.getDoc(name);\n        var changes = JSON.parse(change);\n        doc2 = Automerge.applyChanges(doc, changes);\n        docSet.setDoc(name, doc2);\n      });\n      this.state.socket.on('add doc new doc', /*#__PURE__*/function () {\n        var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref4) {\n          var name, change, initDoc, changes, doc;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  name = _ref4.name, change = _ref4.change;\n                  initDoc = Automerge.change(Automerge.init(), function (doc) {\n                    doc.title = '', doc.cards = [];\n                  });\n                  changes = JSON.parse(change);\n                  doc = Automerge.applyChanges(initDoc, changes);\n                  docSet.setDoc(doc.title, doc);\n\n                  _this2.setState({\n                    docarray: Array.from(docSet.docs)\n                  });\n\n                case 6:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref5.apply(this, arguments);\n        };\n      }());\n      this.state.socket.on('add doc new card', /*#__PURE__*/function () {\n        var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref6) {\n          var name, change, doc, changes, _doc;\n\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  name = _ref6.name, change = _ref6.change;\n                  doc = docSet.getDoc(toString(name));\n\n                  if (doc) {\n                    changes = JSON.parse(change);\n                    _doc = Automerge.applyChanges(doc, changes);\n                    docSet.setDoc(_doc.title, _doc);\n\n                    _this2.setState({\n                      docarray: Array.from(docSet.docs)\n                    });\n                  }\n\n                case 3:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x2) {\n          return _ref7.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"handleClik\",\n    value: function handleClik() {\n      var tmp = this.state.results;\n      tmp.push({\n        'title': this.state.docname\n      });\n      this.setState({\n        results: tmp\n      });\n      this.setState({\n        docname: ''\n      });\n    }\n  }, {\n    key: \"addDoc\",\n    value: function addDoc() {\n      var initDoc = Automerge.change(Automerge.init(), function (doc) {\n        doc.title = 'testDoc', doc.cards = [];\n      });\n      docSet.setDoc(this.state.docname, initDoc);\n      this.setState({\n        docarray: Array.from(docSet.docs)\n      });\n      var changes = Automerge.getAllChanges(initDoc);\n\n      if (this.state.socket != null) {\n        this.state.socket.emit(\"add doc\", {\n          title: this.state.docname,\n          change: JSON.stringify(changes)\n        });\n      }\n    }\n  }, {\n    key: \"deleteDoc\",\n    value: function deleteDoc() {\n      var doc = docSet.getDoc('testdoc');\n\n      if (doc) {\n        docSet.removeDoc('testdoc');\n        console.log('doc deleted: testdoc');\n      }\n\n      this.setState({\n        docarray: Array.from(docSet.docs)\n      });\n    }\n  }, {\n    key: \"addQ\",\n    value: function addQ() {\n      var id = uuid.v4();\n      var doc1 = docSet.getDoc('testdoc');\n\n      if (doc1) {\n        var _doc2 = Automerge.change(doc1, function (doc) {\n          doc.cards.push({\n            id: id,\n            q: 'Number 2?',\n            a: []\n          });\n        });\n\n        docSet.setDoc('testdoc', _doc2);\n        this.setState({\n          docarray: Array.from(docSet.docs)\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Head, {\n          children: /*#__PURE__*/_jsxDEV(\"title\", {\n            children: \"Toohak\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Toohak!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: function onClick() {\n            return _this3.addDoc();\n          },\n          children: \"add document\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: function onClick() {\n            return _this3.deleteDoc();\n          },\n          children: \"delete document\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: function onClick() {\n            return _this3.addQ();\n          },\n          children: \"add question\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"add_document\",\n          autoComplete: \"off\",\n          onChange: function onChange(name) {\n            return _this3.setState({\n              docname: toString(name)\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: function onClick() {\n            return _this3.handleClik();\n          },\n          children: \"delete document\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 116\n        }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n          children: [\"Results: \", JSON.stringify(this.state.docarray, null, 2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Home;\n}(React.Component);\n\nexport { Home as default };","map":{"version":3,"sources":["/home/ablab/Desktop/toohak/testweb/pages/index.js"],"names":["React","uuid","Automerge","Head","io","docSet","DocSet","registerHandler","docId","doc","console","log","JSON","stringify","Home","props","state","data","results","docarray","docname","socket","setState","on","name","getDoc","change","chards","setDoc","title","initDoc","init","cards","changes","parse","applyChanges","Array","from","docs","HOST","PORT","err","remoteAddress","remotePort","doc2","toString","tmp","push","getAllChanges","emit","removeDoc","id","v4","doc1","q","a","addDoc","deleteDoc","addQ","handleClik","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport uuid from 'react-native-uuid';\nimport Automerge from 'automerge'\nimport Head from 'next/head'\nimport io from 'socket.io-client'\n\nconst docSet = new Automerge.DocSet()\n\ndocSet.registerHandler((docId, doc) => {\n    console.log(`[${docId}] ${JSON.stringify(doc)}`)\n})\n\n\n\n\n\nexport default class Home extends React.Component {\n  \n  constructor(props) {\n    super(props)\n    this.state = {\n      data: [{\"name\":\"test1\"},{\"name\":\"test2\"}],\n      results: [],\n      docarray: '',\n      docname:'testdoc',\n      socket: null,\n    }\n  }\n\n\n  componentDidMount() {\n    this.setState({socket: io(\"http://localhost:3000\")})\n    // const socket = io(\"http://localhost:3000\")\n\n    this.state.socket.on('data', ({data, name}) => {\n        let doc = docSet.getDoc(name)\n        doc = Automerge.change(doc, doc => {\n          doc.chards = ['hei']\n        })\n        docSet.setDoc(name, doc)\n    })\n      \n    this.state.socket.on('add doc web', ({title, change}) => {\n        const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = title, doc.cards = []})\n        let changes = JSON.parse(change)\n\n        doc = Automerge.applyChanges(initDoc, changes)\n        docSet.setDoc(title, doc)\n        state.docarray = Array.from(docSet.docs)\n    })\n\n    this.state.socket.on('close', () => {\n        console.log(`[${HOST}:${PORT}] connection closed`)\n    })\n\n    this.state.socket.on('error', (err) => {\n        console.log(`[${socket.remoteAddress}:${socket.remotePort}] error: ${err}`)\n    })\n\n    this.state.socket.on('add card web', ({name, change}) => {\n        const doc = docSet.getDoc(name)\n        let changes = JSON.parse(change)\n        doc2 = Automerge.applyChanges(doc, changes)\n        docSet.setDoc(name, doc2)\n    })\n\n    this.state.socket.on('add doc new doc',async ({name, change}) => {\n        const initDoc = Automerge.change(Automerge.init(), doc => {doc.title = '', doc.cards = []})\n        let changes = JSON.parse(change)\n\n        const doc = Automerge.applyChanges(initDoc, changes)\n        docSet.setDoc(doc.title, doc)\n        this.setState({docarray : Array.from(docSet.docs)})\n\n    })\n\n    this.state.socket.on('add doc new card', async({name, change}) => {\n      const doc = docSet.getDoc(toString(name))\n      if (doc) {\n          let changes = JSON.parse(change)\n          const doc2 = Automerge.applyChanges(doc, changes)\n          docSet.setDoc(doc2.title, doc2)\n          this.setState({docarray : Array.from(docSet.docs)})\n      }\n    })\n  }\n\n \n  handleClik() {\n    const tmp = this.state.results\n    tmp.push({'title': this.state.docname})\n    this.setState({results : tmp})\n    this.setState({docname: ''})\n  }\n\n  addDoc() {\n    let initDoc = Automerge.change(Automerge.init(), doc => {doc.title = 'testDoc', doc.cards = []})\n    docSet.setDoc(this.state.docname, initDoc)\n    this.setState({docarray : Array.from(docSet.docs)})\n\n    let changes = Automerge.getAllChanges(initDoc)\n    if ( this.state.socket != null) {\n      this.state.socket.emit(\"add doc\", ({title: this.state.docname, change: JSON.stringify(changes)}))\n    }\n\n  }\n\n  deleteDoc() {\n    let doc = docSet.getDoc('testdoc')\n    if (doc) {\n        docSet.removeDoc('testdoc')\n        console.log('doc deleted: testdoc');\n    }\n    this.setState({docarray : Array.from(docSet.docs)})\n  }\n\n  addQ() {\n    let id = uuid.v4()\n    let doc1 = docSet.getDoc('testdoc')\n    if (doc1) {\n      let doc2 = Automerge.change(doc1, doc => {\n        doc.cards.push({id: id, q: 'Number 2?', a: []})\n      })\n      docSet.setDoc('testdoc', doc2)\n      this.setState({docarray : Array.from(docSet.docs)})\n      \n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <Head>\n          <title>Toohak</title>\n        </Head>\n        <h1>Toohak!</h1>\n        <button onClick={() => this.addDoc() }>add document</button>\n        {/* <input type=\"text\" value={this.state.docname} onChange={(name) => this.setState({docname: name})} /> */}\n        <button onClick={() => this.deleteDoc()}>delete document</button>\n        <button onClick={() => this.addQ()}>add question</button>\n\n\n        <input id=\"add_document\" autoComplete=\"off\" onChange={(name) => this.setState({docname: toString(name)})}/><button onClick={() => this.handleClik()}>delete document</button>\n      \n\n        <pre>Results: {JSON.stringify(this.state.docarray, null, 2)}</pre>\n      </div>\n\n    ) \n  }\n}\n"]},"metadata":{},"sourceType":"module"}